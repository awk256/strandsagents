
# 概要

　**ファイル操作（File Operation）** は、エージェントに「ファイルの読み書き」という実務能力を付与する構成です。AIが直接OSやファイルシステムを操作するのではなく、定義されたツールという安全な窓口（Proxy/Adapter）を介してのみ操作を行うことで、セキュリティと確実性を両立させています。


```mermaid
sequenceDiagram
    autonumber
    actor User as ユーザー
    participant Agent as Agent<br/>(指示と判断)
    participant Tool as File Tool<br/>(Python関数)
    participant File as File<br/>(report.txt)

    User->>Agent: 書き込み/読み取り依頼
    
    rect rgb(249, 249, 249)
        Note over Agent, Tool: Strands Agent System 内部
        Agent->>Agent: 思考：ファイル操作が必要と判断
        Agent->>Tool: ツール実行の指示 (関数呼び出し)
    end

    alt 書き込みの場合
        Tool->>File: 物理的な書き込み操作
    else 読み取りの場合
        File-->>Tool: ファイル内容の読み出し
    end

    Tool-->>Agent: 実行結果のフィードバック (成功/内容)
    Agent-->>User: ユーザーへの完了報告
```

#### 判断と指令の司令塔 (Agent)

エージェントは、ユーザーの抽象的な依頼（例：「これまでの内容をレポートにまとめておいて」）を受け取ると、それを具体的な「ファイル書き込み」というアクションに変換します。AI自身が直接ハードディスクを叩くのではなく、必ず「ツール」を経由するのがポイントです。

#### 実務を担うインターフェース (File Tool)

**File Tool** は、Pythonなどのプログラムで書かれた実務担当者です。ファイルを開く、書き込む、保存する、といったOSレベルの操作を代行します。このツールがあるおかげで、AIは複雑なファイルシステムを意識せずに「データの永続化」が行えます。

#### 知識の外部保存先 (File)

**File (report.txt)** は、エージェントの短期的なメモリ（会話履歴）とは別の、長期的な保存先です。ここに記録することで、一度プログラムを終了しても、後で別のエージェントや人間がその情報を再利用できるようになります。



# サンプルコード

AIが「ファイルを新規作成」し、その後「中身を確認」する最小構成です。

[file_io.py]
```
import os
from strands import Agent, tool
from strands.models import BedrockModel

# --- 1. ファイル操作ツールの定義 ---

@tool
def write_text_file(filename: str, content: str):
    """指定したファイル名でテキストを保存します。"""
    with open(filename, "w", encoding="utf-8") as f:
        f.write(content)
    return f"ファイル '{filename}' を作成し、内容を書き込みました。"

@tool
def read_text_file(filename: str):
    """指定したファイルの内容を読み取ります。"""
    if not os.path.exists(filename):
        return "エラー: ファイルが見つかりません。"
    with open(filename, "r", encoding="utf-8") as f:
        return f.read()

# --- 2. エージェントの設定 ---

model = BedrockModel(region_name="us-east-1", model_id="us.anthropic.claude-sonnet-4-20250514-v1:0")

agent = Agent(
    model=model,
    system_prompt="あなたはファイル操作が可能なアシスタントです。指示に従ってファイルの作成や読み込みを行ってください。",
    tools=[write_text_file, read_text_file]
)

# --- 3. 実行テスト ---

print("--- 実行: ファイル作成 ---")
print(agent("hello.txtという名前で、'Hello Strands!' という内容のファイルを作って。"))

print("\n--- 実行: 内容確認 ---")
print(agent("先ほど作った hello.txt の中身を教えて。"))
```

# 実行

```
python file_io.py

--- 実行: ファイル作成 ---
hello.txtというファイルに'Hello Strands!'という内容を保存します。
Tool #1: write_text_file
hello.txtファイルが正常に作成されました。'Hello Strands!'という内容が保存されています。hello.txtファイルが正常に作成されました。'Hello Strands!'という内容が保存されています。


--- 実行: 内容確認 ---
hello.txtファイルの内容を読み取ります。
Tool #2: read_text_file
hello.txtファイルの中身は「Hello Strands!」です。hello.txtファイルの中身は「Hello Strands!」です。

(.venv) ubuntu@LAPTOP-DHL9LRBE:~/projects/strands-agents-test$ ls hello.txt
hello.txt
(.venv) ubuntu@LAPTOP-DHL9LRBE:~/projects/strands-agents-test$ cat hello.txt
Hello Strands!

```

