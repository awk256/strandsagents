
# 概要

**外部ツール連携（External Tool Integration）** は、AIエージェントに「手足」となるツール（Python関数）を与え、必要に応じて外部APIやシステムから最新データを取得・操作させるデザインパターンです。LLMの静的な知識では解決できない「現在の気温」「最新のニュース」「在庫状況」といった動的な課題を解決するために不可欠な、エージェント構築の基本モデルです。


**外部ツール連携パターン**を採用することで、AIは閉じた世界から解放され、現実世界のデータと同期した「実行可能な知能」へと進化します。Strands SDKを活用すれば、既存のPython関数をそのままツールとして公開できるため、レガシーなシステムや最新のWebサービスを問わず、あらゆる外部リソースをエージェントの能力として統合することが可能です。


```mermaid
sequenceDiagram
    autonumber
    actor User as ユーザー
    participant Brain as エージェント<br/>(状況判断・選択)
    participant Tool as ツール<br/>(Python関数)
    participant World as 外部API / システム<br/>(リアルタイムデータ)

    User->>Brain: 依頼 (例：「今の東京の天気は？」)
    
    rect rgb(249, 249, 249)
        Note over Brain, Tool: Strands Agent System 内部
        Brain->>Brain: 思考：学習データにない最新情報が必要と判断
        Brain->>Tool: 実行指示 (get_weather 関数を呼び出し)
    end

    Tool->>World: APIリクエスト (HTTP Requestなど)
    World-->>Tool: 取得データ (JSON形式の生データ)
    
    rect rgb(230, 230, 255)
        Tool-->>Brain: 結果返却 (加工されたテキスト)
        Brain->>Brain: 最終回答の組み立て
    end

    Brain-->>User: 最終回答 (例：「現在の東京は晴れ、気温は20℃です」)
```

#### 判断の心臓部 (Brain)

エージェントは、ユーザーの依頼に対して「今の自分の知識で答えられるか？」「外部ツールを使う必要があるか？」をまず判断します。最新のニュース、株価、天気、あるいは社内データベースの数値など、**リアルタイム性が必要な情報はすべてツール経由**で取得することを決定します。

#### 実行の橋渡し (Tool)

ツールは、AIの「願い」を「コンピュータへの命令」に変える翻訳機です。具体的なPython関数として実装されており、複雑な認証やデータ形式の変換（パース）を担います。

#### 広大な外部世界 (World)

APIやデータベースなどの外部システムです。エージェントはツールの手（API）を借りることで、自分が学習した時点（カットオフ）以降に起きた出来事や、動的に変化するデータにアクセスできるようになります。
  
# サンプルコード

このコードは、2つの独立したツールをエージェントが自律的に連携させる「マルチステップ連携」の例です。

[external_tool_ integration.py]
```
import requests
from strands import Agent, tool
from strands.models.bedrock import BedrockModel

# --- ツール1: エンティティ解決（地名 → 座標） ---
@tool
def get_coordinates(location: str):
    """地名から緯度と経度の座標を返します。"""
    # 実際はジオコーディングAPI等を叩きます
    if "東京" in location:
        return {"lat": 35.68, "lon": 139.76}
    return {"lat": 0, "lon": 0}

# --- ツール2: 外部データ取得（座標 → 最新情報） ---
@tool
def get_current_weather(lat: float, lon: float):
    """特定の座標（緯度・経度）から、現在の最新の天気を取得します。"""
    url = f"https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current_weather=true"
    response = requests.get(url).json()
    return response["current_weather"]

# --- エージェントの構築 ---
model = BedrockModel(
    region_name="us-east-1",
    model_id="us.anthropic.claude-sonnet-4-20250514-v1:0",
)

agent = Agent(
    model=model,
    system_prompt="あなたはデータ分析のエキスパートです。ツールを活用して、事実に基づいた最新情報を報告してください。",
    tools=[get_coordinates, get_current_weather] # ツールをセット
)

# --- 実行 ---
# ユーザーは「手順」を指示せず「目的」だけを伝える
response = agent("東京の現在の天気を調べて。")
print(response)
```

# 実行

```
python external_tool_integration.py

東京の天気をお調べします。まず東京の座標を取得してから、天気情報を取得しますね。
Tool #1: get_coordinates

Tool #2: get_weather
東京の現在の天気情報をお知らせします：

**東京の現在の天気**（2025年12月31日 8時30分時点）
- **気温**: 9.4°C
- **風速**: 3.3 m/s
- **風向**: 北東（49度）
- **天候**: 部分的に曇り（天気コード：2）
- **時間帯**: 夜間

現在は夜明け前の時間帯で、気温は9.4度とやや肌寒く、軽い曇り空となっています。風は穏やかな北東の風が吹いています。外出される際は、防寒対策をおすすめします。
```


