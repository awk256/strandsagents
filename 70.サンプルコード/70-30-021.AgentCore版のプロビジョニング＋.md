
# ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°

## Lambdaä½œæˆ

[search_taiwan_news]
- **Function name: search_taiwan_news**
- **Runtime: Python 3.12**
- **Architectur: x86_64**
- **Execution role: Create a new role with basic Lambda permissions**
```
"""
Lambda: search_taiwan_news
å°æ¹¾æœ‰äº‹ã®æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹ãƒ„ãƒ¼ãƒ«
"""
import json

def lambda_handler(event, context):
    # AgentCoreã‹ã‚‰ã®ãƒ„ãƒ¼ãƒ«åæ¤œè¨¼
    tool_name = ""
    if hasattr(context, "client_context") and context.client_context:
        custom = getattr(context.client_context, "custom", {}) or {}
        tool_name = custom.get("bedrockAgentCoreToolName", "")
    
    if "___" in tool_name:
        tool_name = tool_name.split("___", 1)[1]
    
    if tool_name and tool_name != "search_taiwan_news":
        return {"statusCode": 400, "body": json.dumps({"error": "wrong tool"})}
    
    query = event.get("query", "å°æ¹¾æœ‰äº‹")
    
    news_data = {
        "query": query,
        "timestamp": "2025-01-02T00:00:00Z",
        "articles": [
            {"title": "ä¸­å›½è»ãŒå°æ¹¾å‘¨è¾ºã§å¤§è¦æ¨¡è»äº‹æ¼”ç¿’ã‚’å®Ÿæ–½", "source": "Reuters"},
            {"title": "ç±³å›½ãŒå°æ¹¾ã¸ã®æ­¦å™¨å£²å´ã‚’æ‰¿èª", "source": "AP"},
            {"title": "æ—¥æœ¬æ”¿åºœãŒå—è¥¿è«¸å³¶ã®é˜²è¡›å¼·åŒ–ã‚’ç™ºè¡¨", "source": "NHK"},
            {"title": "å°æ¹¾æµ·å³¡ã®ç·Šå¼µãŒé«˜ã¾ã‚‹ä¸­ã€å„å›½ãŒå¤–äº¤åŠªåŠ›", "source": "BBC"},
            {"title": "åŠå°ä½“ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³ã¸ã®å½±éŸ¿æ‡¸å¿µ", "source": "Bloomberg"}
        ],
        "summary": """ã€å°æ¹¾æœ‰äº‹ æœ€æ–°æƒ…å ±ã€‘
1. ä¸­å›½è»ãŒå°æ¹¾å‘¨è¾ºã§è»äº‹æ¼”ç¿’ã‚’å®Ÿæ–½
2. ç±³å›½ãŒå°æ¹¾ã¸ã®æ­¦å™¨å£²å´ã‚’æ‰¿èª
3. æ—¥æœ¬æ”¿åºœãŒå—è¥¿è«¸å³¶ã®é˜²è¡›å¼·åŒ–ã‚’ç™ºè¡¨
4. å°æ¹¾æµ·å³¡ã®ç·Šå¼µãŒé«˜ã¾ã‚‹ä¸­ã€å„å›½ãŒå¤–äº¤åŠªåŠ›
5. åŠå°ä½“ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³ã¸ã®å½±éŸ¿æ‡¸å¿µ"""
    }
    
    return {"statusCode": 200, "body": json.dumps(news_data, ensure_ascii=False)}
```
- Function ARN: arn:aws:lambda:us-east-1:010928207344:function:search_taiwan_news

[search_tahara_personality]
- **Function name: search_tahara_personality**
- **Runtime: Python 3.12**
- **Architectur: x86_64**
- **Execution role: Create a new role with basic Lambda permissions**

```
"""
Lambda: search_tahara_personality
ç”°åŸç·ä¸€æœ—ã®æ€§æ ¼ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãƒ„ãƒ¼ãƒ«
"""
import json

def lambda_handler(event, context):
    tool_name = ""
    if hasattr(context, "client_context") and context.client_context:
        custom = getattr(context.client_context, "custom", {}) or {}
        tool_name = custom.get("bedrockAgentCoreToolName", "")
    
    if "___" in tool_name:
        tool_name = tool_name.split("___", 1)[1]
    
    if tool_name and tool_name != "search_tahara_personality":
        return {"statusCode": 400, "body": json.dumps({"error": "wrong tool"})}
    
    personality_data = {
        "name": "ç”°åŸç·ä¸€æœ—",
        "famous_program": "æœã¾ã§ç”Ÿãƒ†ãƒ¬ãƒ“ï¼",
        "famous_phrases": [
            "ã¡ã‚‡ã£ã¨å¾…ã£ã¦ï¼",
            "ãã‚Œã¯é•ã†ï¼",
            "è¦ã™ã‚‹ã«ä½•ãŒè¨€ã„ãŸã„ã®ï¼Ÿ"
        ],
        "summary": """ã€ç”°åŸç·ä¸€æœ—ã®ç‰¹å¾´ã€‘
- 1934å¹´ç”Ÿã¾ã‚Œã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒªã‚¹ãƒˆ
- ã€Œæœã¾ã§ç”Ÿãƒ†ãƒ¬ãƒ“ï¼ã€ã®å¸ä¼šã§æœ‰å
- ã€Œã¡ã‚‡ã£ã¨å¾…ã£ã¦ï¼ã€ã€Œãã‚Œã¯é•ã†ï¼ã€ãŒå£ç™–
- é‹­ã„è³ªå•ã§æ”¿æ²»å®¶ã®æœ¬éŸ³ã‚’å¼•ãå‡ºã™
- æ›–æ˜§ãªå›ç­”ã«ã¯å®¹èµ¦ãªãçªã£è¾¼ã‚€
- ã€Œè¦ã™ã‚‹ã«ä½•ãŒè¨€ã„ãŸã„ã®ï¼Ÿã€ã¨æ ¸å¿ƒã‚’çªã"""
    }
    
    return {"statusCode": 200, "body": json.dumps(personality_data, ensure_ascii=False)}
```
- Function ARN: arn:aws:lambda:us-east-1:010928207344:function:search_tahara_personality

## ğŸšª AgentCore Gateway ä½œæˆ

### ğŸ›  Gateway ä½œæˆã¨è¨­å®š

> â€» ã“ã®æ¤œè¨¼ã§ã¯ VPC ã®è¨­å®šã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã„ã¾ã™ã€‚

1. **Amazon Bedrock > AgentCore > Gateways > Create gateway** ã‚’ã‚¯ãƒªãƒƒã‚¯
    
2. ä»¥ä¸‹ã®è¨­å®šã‚’å…¥åŠ›ï¼š
    
### ğŸ” åŸºæœ¬è¨­å®š

- **Gateway name**: `gateway-quick-start-d41057`
- **Inbound Auth type**: `Use JSON Web Tokens (JWT)`
- **JWT schema configuration**: `JWT schema configuration`
- **IAM Permissions**: `Create and use a new service role`
- **Service role name**: `AmazonBedrockAgentCoreGatewayDefaultServiceRole1767347537681`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰  

	â†’ã¾ãŸã¯ `My Service Role Name`ï¼ˆä»»æ„ï¼‰

### ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®šï¼ˆLambda é–¢æ•°ï¼‰

#### âœ… ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ 1

- **Target name**: `target-quick-start-f1f98c`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåï¼‰
- **Target Type**: `Lambda ARN`
- **Lambda ARN**:  
    `arn:aws:lambda:us-east-1:<My Account ID>:function:search_taiwan_news`
- **Target schema**: `Define an inline schema`
- **Inline schema editor**:
```json
{
  "name": "search_taiwan_news",
  "description": "å°æ¹¾æœ‰äº‹ã«é–¢ã™ã‚‹æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æƒ…å ±ã‚’æ¤œç´¢ãƒ»å–å¾—ã™ã‚‹ã€‚è¨è«–ã®æº–å‚™ã‚„æœ€æ–°æƒ…å ±ã®ç¢ºèªã«ä½¿ç”¨ã€‚",
  "inputSchema": {
    "type": "object",
    "properties": {
      "query": {
        "type": "string",
        "description": "æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆä¾‹: å°æ¹¾æœ‰äº‹ã€ä¸­å›½è»äº‹æ¼”ç¿’ï¼‰",
        "default": "å°æ¹¾æœ‰äº‹"
      }
    },
    "required": []
  }
}
```

#### â• ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ 2 ã‚’è¿½åŠ 

- **Target name**: `target-quick-start-cd3847`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåï¼‰
- **Lambda ARN**:  
    `arn:aws:lambda:us-east-1:<My Account ID>:function:search_tahara_personality`
- **Target schema**: `Define an inline schema`
- **Inline schema editor**:

```json
{
  "name": "search_tahara_personality",
  "description": "ç”°åŸç·ä¸€æœ—ã®æ€§æ ¼ã€å¸ä¼šã‚¹ã‚¿ã‚¤ãƒ«ã€å£ç™–ãªã©ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã€‚å¸ä¼šè€…ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®äººæ ¼è¨­å®šã«ä½¿ç”¨ã€‚",
  "inputSchema": {
    "type": "object",
    "properties": {
      "detail_level": {
        "type": "string",
        "description": "æƒ…å ±ã®è©³ç´°åº¦ï¼ˆstandard/detailedï¼‰",
        "enum": ["standard", "detailed"],
        "default": "standard"
      }
    },
    "required": []
  }
}
```

### ğŸ“¦ Gateway ä½œæˆ

- **[Create gateway]** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å®Œäº†
    
### ğŸ“‹ ä½œæˆå¾Œã«æ§ãˆã¦ãŠãã¹ãæƒ…å ±

- **Gateway Resource URL**
```
https://gateway-quick-start-d41057-bojslcregg.gateway.bedrock-agentcore.us-east-1.amazonaws.com/mcp
```
   
â†’ `.env` ç”¨å¤‰æ•°ï¼š`AGENTCORE_GATEWAY_ENDPOINT`
    
- **Discovery URL**
```
https://cognito-idp.us-east-1.amazonaws.com/us-east-1_6EiNfrH8r/.well-known/openid-configuration
```
    
â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_DISCOVERY_URL`

## S3ãƒã‚±ãƒƒãƒˆä½œæˆ

```
$ aws s3 mb s3://debate-sessions-bucket-123 --region us-east-1
make_bucket: debate-sessions-bucket-123

$ aws s3 ls --region us-east-1 | grep debate-sessions-bucket-123
2026-01-02 21:17:04 debate-sessions-bucket-123
```

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[requirements.txt]
```
strands-agents>=0.1.0
strands-agents-tools>=0.1.0
mcp>=1.0.0
boto3>=1.34.0
requests>=2.31.0
httpx>=0.27.0
python-dotenv>=1.0.0
```

```
uv pip install -r requirements.txt
```


## ğŸŒ ç’°å¢ƒå¤‰æ•°è¨­å®šï¼šCognitoé€£æºã¨OAuthæ§‹æˆ

### ğŸ§‘â€ğŸ’» Cognito ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«æƒ…å ±ã®ç¢ºèª

1. **Amazon Cognito > User Pools** ã‹ã‚‰ã€  
    ã€€`User Pool Name` ã‚’ã‚¯ãƒªãƒƒã‚¯
    
2. è©²å½“ã® `User Pool` ã¯ä»¥ä¸‹ã® Discovery URL ã‹ã‚‰è­˜åˆ¥ï¼š
    
```
https://cognito-idp.us-east-1.amazonaws.com/us-east-1_6EiNfrH8r
```

> â†’ User Pool IDï¼š`us-east-1_6EiNfrH8r`  
> â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_DISCOVERY_URL=https://cognito-idp.us-east-1.amazonaws.com/us-east-1_6EiNfrH8r/.well-known/openid-configuration`

###  ğŸ”‘ App ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æƒ…å ±ã‚’æ§ãˆã‚‹

1. å¯¾è±¡ã® **App client name** ã‚’ã‚¯ãƒªãƒƒã‚¯
    
2. ä»¥ä¸‹ã®æƒ…å ±ã‚’å–å¾—ï¼š
    
- **Client ID**:
    
    ```
    3oof9hskpofsh8gpqso04st696
    ```
    
    â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_CLIENT_ID`
    
- **Client secret**:
    
    ```
    ***************************************
    ```
    
    â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_CLIENT_SECRET`
    
### âš™ï¸ Python OAuth è¨­å®šï¼ˆauthlibï¼‰

OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šæ™‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ§‹æˆï¼š

```python
oauth.register(
    ...
    client_kwargs={
        "scope": "gateway-quick-start-d41057/genesis-gateway:invoke"
    }
)
```

â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_CUSTOM_SCOPE=gateway-quick-start-d41057/genesis-gateway:invoke`

å¿…è¦ã«å¿œã˜ã¦ã€`.env` ã‚„ `authlib` ã®è¨­å®šã«åæ˜ ã—ã¦ãã ã•ã„ã€‚

[.env]
```
# AWS èªè¨¼æƒ…å ±
# AWS_DEFAULT_REGION=us-east-1

# Bedrock è¨­å®š
BEDROCK_MODEL_ID=us.anthropic.claude-sonnet-4-20250514-v1:0
BEDROCK_MAX_TOKENS=8192

# AgentCore Gateway
AGENTCORE_GATEWAY_ENDPOINT=https://<my-gateway-id>.gateway.bedrock-agentcore.us-east-1.amazonaws.com/mcp

# Cognito èªè¨¼ï¼ˆM2Mï¼‰
COGNITO_CLIENT_ID=YOUR_APP_CLIENT_ID
COGNITO_CLIENT_SECRET=YOUR_APP_CLIENT_SECRET
COGNITO_DISCOVERY_URL=https://cognito-idp.us-east-1.amazonaws.com/<user-pool-id>/.well-known/openid-configuration
COGNITO_CUSTOM_SCOPE=<gateway-name>/genesis-gateway:invoke

# S3 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
S3_SESSION_BUCKET=debate-sessions-bucket-123
S3_SESSION_PREFIX=debate_sessions

# è¨è«–ä¼šè¨­å®š
DEBATE_TOPIC=å°æ¹¾æœ‰äº‹ã®å•é¡Œ
DEBATE_SESSION_ID=session_001
```

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[requirements.txt]
```
strands-agents>=0.1.0
strands-agents-tools>=0.1.0
mcp>=1.0.0
boto3>=1.34.0
requests>=2.31.0
httpx>=0.27.0
python-dotenv>=1.0.0
```

```
uv pip install -r requirements.txt
```

## ğŸŒ ç’°å¢ƒå¤‰æ•°è¨­å®šï¼šCognitoé€£æºã¨OAuthæ§‹æˆ

### ğŸ§‘â€ğŸ’» Cognito ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«æƒ…å ±ã®ç¢ºèª

1. **Amazon Cognito > User Pools** ã‹ã‚‰ã€  
    ã€€`User Pool Name` ã‚’ã‚¯ãƒªãƒƒã‚¯
    
2. è©²å½“ã® `User Pool` ã¯ä»¥ä¸‹ã® Discovery URL ã‹ã‚‰è­˜åˆ¥ï¼š
    

```
https://cognito-idp.us-east-1.amazonaws.com/us-east-1_6EiNfrH8r
```

> â†’ User Pool IDï¼š`us-east-1_6EiNfrH8r`  
> â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_DISCOVERY_URL=https://cognito-idp.us-east-1.amazonaws.com/us-east-1_6EiNfrH8r/.well-known/openid-configuration`

###  ğŸ”‘ App ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æƒ…å ±ã‚’æ§ãˆã‚‹

1. å¯¾è±¡ã® **App client name** ã‚’ã‚¯ãƒªãƒƒã‚¯
    
2. ä»¥ä¸‹ã®æƒ…å ±ã‚’å–å¾—ï¼š
    
- **Client ID**:
    
    ```
    3oof9hskpofsh8gpqso04st696
    ```
    
    â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_CLIENT_ID`
    
- **Client secret**:
    
    ```
    ***************************************
    ```
    
    â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_CLIENT_SECRET`
    

### âš™ï¸ Python OAuth è¨­å®šï¼ˆauthlibï¼‰

OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šæ™‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ§‹æˆï¼š

```python
oauth.register(
    ...
    client_kwargs={
        "scope": "gateway-quick-start-d41057/genesis-gateway:invoke"
    }
)
```

â†’ `.env` ç”¨å¤‰æ•°ï¼š`COGNITO_CUSTOM_SCOPE=gateway-quick-start-d41057/genesis-gateway:invoke`


å¿…è¦ã«å¿œã˜ã¦ã€`.env` ã‚„ `authlib` ã®è¨­å®šã«åæ˜ ã—ã¦ãã ã•ã„ã€‚

[.env]
```
# AWS èªè¨¼æƒ…å ±
# AWS_DEFAULT_REGION=us-east-1

# Bedrock è¨­å®š
BEDROCK_MODEL_ID=us.anthropic.claude-sonnet-4-20250514-v1:0
BEDROCK_MAX_TOKENS=8192

# AgentCore Gateway
AGENTCORE_GATEWAY_ENDPOINT=https://<my-gateway-id>.gateway.bedrock-agentcore.us-east-1.amazonaws.com/mcp

# Cognito èªè¨¼ï¼ˆM2Mï¼‰
COGNITO_CLIENT_ID=YOUR_APP_CLIENT_ID
COGNITO_CLIENT_SECRET=YOUR_APP_CLIENT_SECRET
COGNITO_DISCOVERY_URL=https://cognito-idp.us-east-1.amazonaws.com/<user-pool-id>/.well-known/openid-configuration
COGNITO_CUSTOM_SCOPE=<gateway-name>/genesis-gateway:invoke

# S3 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
S3_SESSION_BUCKET=debate-sessions-bucket-123
S3_SESSION_PREFIX=debate_sessions

# è¨è«–ä¼šè¨­å®š
DEBATE_TOPIC=å°æ¹¾æœ‰äº‹ã®å•é¡Œ
DEBATE_SESSION_ID=session_001
```
